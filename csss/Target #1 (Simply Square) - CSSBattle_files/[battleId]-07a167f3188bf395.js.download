(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4789],{9249:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/battle/[battleId]",function(){return a(5806)}])},6972:function(e,t,a){"use strict";a.d(t,{E:function(){return j}});var n=a(2322),i=a(2784),s=a(9097),r=a.n(s),l=a(2367),o=a(7037),c=a(9241),d=a(5598),u=a(1251),h=a(5416),m=a(7841),f=a(930),p=function(e){var t=e.items,a=(0,i.useState)(t),s=a[0],r=a[1],l=(0,i.useRef)(),o=(0,i.useRef)(),c=(0,i.useCallback)((function(e){null!==e&&(null===s||void 0===s?void 0:s.length)>0&&(o.current=e.firstChild,l.current=e,document.documentElement.style.setProperty("--animationDistance","".concat(0-o.current.offsetWidth,"px")),document.documentElement.style.setProperty("--animationDuration","".concat(Math.round(o.current.offsetWidth/60),"s")),l.current.classList.add("moving"))}),[s]),d=function(e){var t=e.shift();e.splice(e.length,0,t),r(e)};return(0,n.jsx)("div",{className:"ticker-wrapper",children:(0,n.jsx)("div",{className:"ticker-inner",ref:c,onAnimationEnd:function(){l.current.classList.remove("moving"),l.current.style.animation="none",l.current.offsetHeight,l.current.style.animation=null,d((0,f.Z)(s))},children:null===s||void 0===s?void 0:s.map((function(e,t){return(0,n.jsx)(g,{item:e},t)}))})})},g=function(e){var t=e.item;return(0,n.jsx)("div",{className:"ticker-element",children:t})},x=a(3125);function j(e){var t=e.battleId,a=(0,i.useState)(!1),s=a[0],l=a[1],u=(0,i.useState)([]),f=u[0],g=u[1];return(0,i.useEffect)((function(){l(!0),(0,o.V6)(t).then((function(e){l(!1),e.length&&e.unshift(e.pop()),g(e)}))}),[t]),(0,n.jsxs)(n.Fragment,{children:[s&&(0,n.jsx)(h.s,{onlyBorder:!0,padding:"0.5rem",children:(0,n.jsxs)(d.HStack,{gap:"0",justify:"center",children:[(0,n.jsx)(c.a,{height:"1em"})," ",(0,n.jsx)(m.x,{mono:!1,weight:500,children:"Loading activities"})]})}),!s&&f.length>0&&(0,n.jsx)(x.E.div,{initial:{opacity:0},animate:{opacity:1,transition:{delay:.3}},layout:!0,children:(0,n.jsx)(p,{items:f.map((function(e){return(0,n.jsx)("div",{className:"activity-item",children:(0,n.jsx)(b,{timeStamp:e.timestamp,profile:e.playerProfile,children:(0,n.jsxs)(m.x,{mono:!1,size:"0",weight:"500",appearance:"secondary",children:[(0,n.jsxs)(m.x,{mono:!1,size:"0",weight:"500",appearance:"primary",children:[(0,n.jsx)(r(),{href:"/player/".concat(e.playerProfile.username||e.playerProfile.id||e.playerProfile.uid),children:(0,n.jsx)("a",{className:"link link--no-underline",children:e.playerProfile.displayName})})," "]}),e.data.userId===e.data.previousUserId?"broke own record on":"set a new record on"," ",(0,n.jsx)(r(),{href:"/play/".concat(e.data.levelId),children:(0,n.jsxs)("a",{className:"link link--no-underline",children:["#",e.data.levelId]})})," ","with ",e.data.codeSize," chars (",e.data.codeSize-e.data.previousUserCodeSize,")."]})},e.id)})}))})})]})}var b=function(e){var t=e.profile,a=e.timeStamp,i=e.children;return(0,n.jsx)(h.s,{onlyBorder:!0,padding:"0.5rem 1rem 0.5rem 0.5rem",children:(0,n.jsxs)(d.HStack,{align:"center",gap:"0.5rem",children:[(0,n.jsx)(u.qE,{name:t.displayName,size:"24",url:t.avatar,username:t.username,userId:t.id||t.uid,useCdnUrl:!0}),(0,n.jsx)("span",{children:i}),(0,n.jsxs)(m.x,{mono:!1,size:"0",weight:"500",appearance:"tertiary",children:[(0,l.VG)(a)," ago"]})]})})}},419:function(e,t,a){"use strict";a.d(t,{a:function(){return c}});var n=a(2322),i=a(7500),s=a(2259),r=a.n(s),l=a(5598),o=a(9604);function c(e){var t=e.gameMode,a=e.minimal,s=void 0!==a&&a,c=e.onClose;return s?(0,n.jsx)("div",{className:"pill",children:t===i.BattleGameModes.FIRST_TO_MATCH?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"pill__emoji",children:"\u23f0"})," Time Attack"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"pill__emoji",children:"\u26f3"})," Code Golf"]})}):(0,n.jsxs)("div",{className:"".concat(r().battleMode," ").concat(r().battleModeLarge),children:[t===i.BattleGameModes.FIRST_TO_MATCH?(0,n.jsxs)(l.HStack,{children:[(0,n.jsx)("p",{className:r().gameModeLabel,children:"\u23f0"}),(0,n.jsxs)(l.VStack,{gap:"0.25rem",align:"flex-start",children:["Time Attack",(0,n.jsx)("p",{className:r().gameModeLabelDesc,children:"Quickest to get 100% matches wins the game"})]})]}):(0,n.jsxs)(l.HStack,{children:[(0,n.jsx)("p",{className:r().gameModeLabel,children:"\u26f3"}),(0,n.jsxs)(l.VStack,{gap:"0.25rem",align:"flex-start",children:["Code Golf",(0,n.jsx)("p",{className:r().gameModeLabelDesc,children:"Shortest code with a 100% match gets the highest score"})]})]}),c&&(0,n.jsx)("a",{className:r().closeBtn,onClick:c,children:(0,n.jsx)(o.J,{name:"cross",marginRight:"0",size:"18"})})]})}},9411:function(e,t,a){"use strict";a.d(t,{L:function(){return r}});var n=a(6383),i=a(4030),s=a(9318);function r(e){var t=e.levelId,a=e.battleId,r=(0,n.Z)((0,s._)("showCSSLeaderboard",!0),2),l=r[0],o=r[1];return(0,i.isNonCssAvailable)({levelId:t,battleId:a})?[l,o]:[!0,function(){}]}},5806:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return W}});var n=a(2322),i=a(2784),s=a(5632),r=a(7729),l=a.n(r),o=a(7500),c=a(6383),d=a(7037),u=a(3552),h=a(9318),m=a(9097),f=a.n(m),p=a(9411),g=a(6368),x=a(2367),j=a(5598),b=a(9955),y=function(e){e.title;var t=e.battleId,a=e.numOfPlayersToShow,s=void 0===a?10:a,r=(0,i.useContext)(u.S),l=(0,i.useState)([]),m=l[0],x=l[1],y=(0,i.useState)({}),v=y[0],S=y[1],w=(0,i.useState)(),N=w[0],I=w[1],B=(0,c.Z)((0,h._)("showFriendsLeaderboard",!!r),2),_=B[0],k=B[1],C=(0,c.Z)((0,p.L)({battleId:t}),2),E=C[0],M=C[1],L=(0,o.checkIfCustomBattle)({id:t}),T=(0,g.A)({battleId:t}),D=(0,i.useState)({battlePlayerCount:{}}),O=(D[0],D[1]);return(0,i.useEffect)((function(){(0,d.pc)().then(O)}),[]),(0,i.useEffect)((function(){T&&(I(!0),(_&&r?(0,d.eL)({battleId:t,userId:r.uid,isCSSLeaderboard:E}):(0,d.uL)({battleId:t,numberOfPlayers:s,isCSSLeaderboard:E})).then((function(e){if(E||e.map((function(e){var t,a;e.score=null===(t=e.overall)||void 0===t?void 0:t.score,e.lastUpdated=null===(a=e.overall)||void 0===a?void 0:a.lastUpdated})),x(e),I(!1),e.length||S({}),r&&e.length)if(e.find((function(e){return e.id===r.uid}))){var a=e.find((function(e){return e.id===r.uid}));S({rank:e.findIndex((function(e){return e.id===r.uid}))+1,score:a.score})}else(0,d.r8)({userId:r.uid,battleId:t}).then((function(e){S(e)})).catch((function(e){console.log("failed to fetch rank",e)}))})))}),[r?r.uid:"",t,T,_,E]),(0,n.jsx)(b.A,{type:"battle",title:"Battle leaders",battleId:t,rankData:v,leaderboard:m,isFetchingLeaderboard:N,isFriendsMode:_,isCSSLeaderboard:E,showTypeSwitcher:!0,setIsCSSLeaderboard:M,canBeCompletelyEmpty:!0,onLeaderboardFriendTypeChange:function(e){k("friends"===e.target.value)},noRankMessage:"Play at least 1 target to see your rank.",footer:(0,n.jsxs)(j.VStack,{gap:"0.5rem",children:[(0,n.jsx)(f(),{href:"/leaderboard/battle/".concat(t),children:(0,n.jsx)("a",{className:"button button--full-width",children:"See top 100"})}),!L&&(0,n.jsx)(f(),{href:"/leaderboard",children:(0,n.jsx)("a",{className:"button button--full-width",children:"All-time leaderboard"})})]})})},v=a(865),S=a(6670),w=a(4807),N=a(1251),I="all",B="played",_="notPlayed";function k(e){var t=e.battle,a=(0,i.useContext)(u.S),s=(0,i.useState)([]),r=s[0],l=s[1],o=(0,i.useState)(),c=o[0],h=o[1],m=(0,i.useState)(0),f=(m[0],m[1]),p=(0,i.useState)(I),g=p[0];p[1];return(0,i.useEffect)((function(){(0,d.TU)(t.levelIds).then(l)}),[t.id]),(0,i.useEffect)((function(){f(0),h(),a&&(0,d.HC)({userId:a.uid,levelIds:t.levelIds}).then((function(e){f(Object.keys(e).length),h(e)}))}),[a?a.uid:"",t.id]),(0,n.jsx)("div",{children:(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"targets-container",children:r.map((function(e,a){return g===I||g===B&&c[e.id]||g===_&&!c[e.id]?(0,n.jsx)(w.E,{data:(0,S.Z)((0,v.Z)({},e),{id:e.id,isOpen:!(!t.openLevelIds||!t.openLevelIds.includes(e.id||t.firstLevelId+a))}),playerData:c?c[e.id]:void 0,index:a,totalLevels:r.length,battleStartDate:t.startDate,targetBatches:t.targetBatches,gameMode:t.gameMode},a):null}))})})})}var C=a(8788);var E=a(2970),M=a(3029),L=a(1551),T=a(1893),D=a(3290),O=a(2220),P=a(419),z=a(4030),F=a(7841),G=a(3125),H=a(5416);a(4896);function A(e){return e.endDate||+new Date(1e3*e.startDate.seconds)+60*e.duration*1e3}function U(e){var t=e.battle,a=function(){return r&&(!r.settings||!r.settings.emailNotifications)&&!1!==u},r=(0,T.a)(),l=(0,s.useRouter)(),c=(0,i.useState)(),u=c[0],h=c[1],m=(0,o.checkIfCustomBattle)(t),p=(0,i.useState)((0,o.getBattleStatus)(t)),g=p[0],b=p[1],y=(0,i.useState)(!1),v=y[0],S=y[1],w=(0,i.useState)({battlePlayerCount:{}}),I=w[0],B=w[1];function _(e){return k.apply(this,arguments)}function k(){return(k=(0,C.Z)((function(e){var a,n;return(0,E.__generator)(this,(function(i){switch(i.label){case 0:return r?[4,r.firebaseUser.getIdToken()]:[3,2];case 1:return n=i.sent(),[3,3];case 2:n="",i.label=3;case 3:return(a=n)?(S(!0),[2,fetch("".concat(d.bl,"/").concat(e===o.BattleStatuses.ONGOING?"startBattle":"stopBattle","?token=").concat(a,"&battleId=").concat(t.id)).then((function(e){return S(!1),e}))]):[2]}}))}))).apply(this,arguments)}function U(){return U=(0,C.Z)((function(){return(0,E.__generator)(this,(function(e){return r?t.levelIds.length?window.confirm("You cannot edit or restart a battle once it is started. Are you sure you want to start this battle?")?(_(o.BattleStatuses.ONGOING).then(function(){var e=(0,C.Z)((function(e){var t;return(0,E.__generator)(this,(function(a){switch(a.label){case 0:return 200===e.status?((0,x.lC)(3),b(o.BattleStatuses.ONGOING),[2]):[4,e.json()];case 1:return"insufficientCredits"===(t=a.sent()).error?(window.confirm("You have insufficient credits to start this custom battle. Click OK to proceed to buying credits.")&&l.push("/settings?tab=custom-battle-credits"),[2]):"noTargetsFound"===t.error?(window.alert("You have not added any targets yet. Add at least 1 target to before starting the battle."),[2]):[2]}}))}));return function(t){return e.apply(this,arguments)}}()).catch((function(e){S(!1),alert("Battle could not be started. Try one more time, otherwise DM us on twitter: @css_battle")})),[2]):[2]:[2,window.alert("You have not added any targets yet. Add at least 1 target to before starting the battle.")]:[2]}))})),U.apply(this,arguments)}i.useEffect((function(){(0,d.pc)().then(B)}),[t]),i.useEffect((function(){b((0,o.getBattleStatus)(t))}),[t]);var R=function(e){e=null!==e?e:function(e){throw e}(new TypeError("Cannot destructure undefined"));return(0,n.jsxs)(N.xu,{className:"battle-lights-container  battle-lights-container--".concat(g==o.BattleStatuses.FINISHED?"finished":g==o.BattleStatuses.UPCOMING?"upcoming":"ongoing"),children:[(0,n.jsx)("div",{className:"battle-lights battle-lights--left battle-lights--1"}),(0,n.jsx)("div",{className:"battle-lights battle-lights--left battle-lights--2"}),(0,n.jsxs)(F.x,{size:4,weight:"600",tag:"h1",appearance:"primary",mono:!1,children:[!m&&(0,n.jsxs)(n.Fragment,{children:["Battle ",(0,n.jsx)(N.bN,{id:t.id})," -"," "]})," ",t.name]}),(0,n.jsx)("div",{className:"battle-lights battle-lights--right battle-lights--1"}),(0,n.jsx)("div",{className:"battle-lights battle-lights--right battle-lights--2"})]})};return(0,n.jsx)("div",{className:"battle-info-section",children:(0,n.jsxs)(j.VStack,{gap:"1rem",children:[(0,n.jsx)(R,{}),(0,n.jsxs)(j.HStack,{gap:"1rem",children:[(0,n.jsx)(G.E.div,{layout:!0,children:(0,n.jsx)(M.k,{status:g})}),(0,n.jsx)(G.E.div,{layout:!0,children:(0,n.jsx)(P.a,{gameMode:t.gameMode,minimal:!0})}),t&&I.battlePlayerCount[t.id]&&(0,n.jsx)(G.E.div,{layout:!0,children:(0,n.jsxs)("div",{className:"pill",children:[I.battlePlayerCount[t.id].toLocaleString()," ","players"]})})]}),(0,n.jsxs)("div",{className:"battle-info__description",children:[t.description?(0,n.jsxs)("p",{children:[t.description," ",g===o.BattleStatuses.ONGOING?"This battle will end on ".concat((0,x.Jp)(A(t)),". "):"",g===o.BattleStatuses.UPCOMING&&t.startDate?"This battle will start on ".concat((0,x.Jp)((0,z.normalizeDate)(t.startDate)),". "):"",t.sponsor?(0,n.jsxs)(n.Fragment,{children:["Sponsored by"," ",(0,n.jsx)("a",{className:"link",href:t.sponsor.link,children:t.sponsor.name}),".",t.rewards?" The following rewards will be given to players at the end of the Battle.":null]}):null]}):null,t.rewards?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"battle-rewards",children:[t.rewards.gold?(0,n.jsx)("div",{className:"reward-tile reward-tile--gold",children:t.rewards.gold}):null,t.rewards.silver?(0,n.jsx)("div",{className:"reward-tile reward-tile--silver",children:t.rewards.silver}):null,t.rewards.bronze?(0,n.jsx)("div",{className:"reward-tile reward-tile--bronze",children:t.rewards.bronze}):null,t.rewards.others?(0,n.jsx)("div",{className:"reward-tile reward-tile--regular",children:t.rewards.others}):null]}),(0,n.jsx)("p",{style:{fontSize:"12px",marginTop:"-30px"},children:t.rewards.note})]}):null]}),g===o.BattleStatuses.UPCOMING&&t.startDate?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(j.VStack,{gap:"0.75rem",children:[(0,n.jsx)("div",{className:"battle-info-end-pill",children:(0,n.jsx)(F.x,{size:0,weight:"semibold",appearance:"tertiary",children:"STARTS IN"})}),(0,n.jsx)(N.xu,{style:{padding:"0.6rem 1.5rem"},children:(0,n.jsx)(L.W,{showEmoji:!1,suffix:"",date:(0,z.normalizeDate)(t.startDate),onFinish:function(){window.location.reload()},size:"0.15"})})]})}):null,g===o.BattleStatuses.FINISHED&&(0,n.jsx)("div",{style:{marginTop:"1rem"},children:(0,n.jsx)(H.s,{onlyBorder:!0,padding:"1rem",children:(0,n.jsxs)(j.VStack,{gap:"1.5rem",children:[(0,n.jsx)(F.x,{mono:!1,weight:"500",appearance:"secondary",size:"1",align:"center",children:m?"This Battle has finished. But you can always play the targets below. Note: Custom battle targets don't  contribute to your global ranking.":"This Battle has finished. But you can always play the targets below and improve your global ranking!"}),a()&&(0,n.jsx)(O.z,{primary:!0,onClick:function(){h(!0),(0,D.q)({name:"emailNotificationUpdated",label:1}),(0,d.Ii)(r.uid,{"settings.emailNotifications":!0}).then((function(){h(!1)}))},isLoading:u,children:"Get Notified via Email about new Battles"}),!1===u?(0,n.jsx)(F.x,{mono:!1,weight:"500",appearance:"brand",size:"1",align:"center",children:"Great! We'll notify you about upcoming battles!"}):null,a()&&(0,n.jsx)(F.x,{mono:!1,weight:"500",appearance:"tertiary",size:"1",align:"center",children:"With this, you'll also receive future emails from us regarding such announcements. We won't spam you :)"})]})})}),g===o.BattleStatuses.ONGOING&&t.startDate?(0,n.jsxs)(j.VStack,{gap:"0.75rem",children:[(0,n.jsx)("div",{className:"battle-info-end-pill",children:(0,n.jsx)(F.x,{size:0,weight:"semibold",appearance:"tertiary",children:"ENDS IN"})}),(0,n.jsx)(N.xu,{style:{padding:"0.6rem 1.5rem"},children:(0,n.jsx)(L.W,{showEmoji:!1,suffix:"",date:A(t),onFinish:function(){b((0,o.getBattleStatus)(t))},size:"0.15"})})]}):null,!r&&(0,n.jsx)("p",{children:(0,n.jsx)(f(),{href:"/login",children:(0,n.jsx)("a",{className:"button",children:"Sign In / Sign Up"})})}),r&&r.uid===t.createdBy?(0,n.jsxs)(N.hE,{center:!0,children:[g===o.BattleStatuses.UPCOMING?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(O.z,{primary:!0,onClick:function(){return U.apply(this,arguments)},isLoading:v,children:"Start Battle"}),(0,n.jsx)("a",{className:"link",href:"/battle/create/".concat(t.id),children:"Edit"})]}):null,g===o.BattleStatuses.ONGOING?(0,n.jsx)(O.z,{danger:!0,onClick:function(){window.confirm("You cannot restart a battle once it is stopped. Are you sure you want to stop this battle?")&&_(o.BattleStatuses.FINISHED).then(function(){var e=(0,C.Z)((function(e){return(0,E.__generator)(this,(function(t){return 200===e.status?(b(o.BattleStatuses.FINISHED),[2]):[2]}))}));return function(t){return e.apply(this,arguments)}}()).catch((function(e){S(!1),alert("Battle could not be stopped. Try one more time, otherwise DM us on twitter: @css_battle")}))},isLoading:v,children:"Stop Battle"}):null]}):null]})})}var R=a(6972),V=a(9241),Z=(0,G.E)(j.HStack),W=function(){var e=(0,s.useRouter)(),t=(0,i.useContext)(u.S),a=(0,i.useState)(!1),r=(a[0],a[1]),c=(0,i.useState)(),h=c[0],m=c[1];(0,i.useEffect)((function(){if(e.isReady){var t=e.query.battleId,a=(0,x.NR)(t);r(a),m(a?t:parseInt(t,10))}}),[e.isReady,e.query.battleId]);var f=(0,i.useState)(),p=f[0],g=f[1];(0,i.useEffect)((function(){h&&(0,d.ch)(h).then((function(e){(0,o.getBattleStatus)(e)!==o.BattleStatuses.UPCOMING||t&&e.createdBy===t.uid||(e.levelIds=e.levelIds.map((function(){return 0}))),g(e)}))}),[h]);var b=(0,i.useContext)(u.k).setBattle;return(0,i.useEffect)((function(){return b(p),function(){b(null)}}),[p]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l(),{children:p?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("meta",{property:"og:title",content:"Battle #".concat(p.id,": ").concat(p.name," - CSSBattle")},"ogTitle"),(0,n.jsx)("title",{children:"Battle #".concat(p.id,": ").concat(p.name," - CSSBattle")},"title")]}):null}),p?(0,n.jsx)("div",{children:(0,n.jsxs)(j.VStack,{gap:"3rem",align:"stretch",children:[(0,n.jsx)(G.E.div,{initial:{opacity:0},animate:{opacity:1,transition:{delay:.2}},children:(0,n.jsx)(U,{battle:p})}),h.length?null:(0,n.jsx)(G.E.div,{initial:{opacity:0},animate:{opacity:1,transition:{delay:.2}},children:(0,n.jsx)(R.E,{battleId:p.id})}),(0,n.jsxs)(Z,{layout:!0,align:"flex-start",gap:"3rem",responsive:!0,children:[(0,n.jsx)(G.E.div,{style:{flex:1},initial:{y:-10,opacity:0},animate:{y:0,opacity:1,transition:{delay:.4}},children:(0,n.jsx)(k,{battle:p})}),(0,n.jsx)(G.E.div,{style:{minWidth:"18rem",flex:"0 0 0"},initial:{x:-10,opacity:0},animate:{x:0,opacity:1,transition:{delay:.6}},children:p?(0,n.jsx)(y,{title:"Battle Leaderboard",battleId:p.id}):null})]})]})}):(0,n.jsx)(G.E.div,{className:"container",initial:{y:10,opacity:0},exit:{y:10,opacity:0},animate:{y:0,opacity:1,transition:{delay:.1}},children:(0,n.jsx)("div",{className:"container__item container__item--main",children:(0,n.jsx)(V.R,{children:"Fetching battle details..."})})})]})}},2259:function(e){e.exports={battleMode:"BattleModeInfoPill_battleMode___alHa",battleModeLarge:"BattleModeInfoPill_battleModeLarge__yo3LS",gameModeLabel:"BattleModeInfoPill_gameModeLabel__m7soO",gameModeLabelDesc:"BattleModeInfoPill_gameModeLabelDesc__INih3",closeBtn:"BattleModeInfoPill_closeBtn__f0ikT"}}},function(e){e.O(0,[4807,9955,9774,2888,179],(function(){return t=9249,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=[battleId]-07a167f3188bf395.js.map