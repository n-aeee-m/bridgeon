(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8865],{4610:function(e,r,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/me",function(){return i(9724)}])},8431:function(e,r,i){"use strict";i.d(r,{x:function(){return u}});var s=i(2322),a=i(9604),o=i(5598),t=i(3196),n=i.n(t),c=i(7841),l=i(8329),d=i(3125),u=function(e){var r=e.icon,i=e.showProBadge,t=e.title,u=e.subtitle;return(0,s.jsx)(d.E.div,{className:n().innerPageHeader,initial:{opacity:0},exit:{opacity:0},animate:{opacity:1},children:(0,s.jsxs)(o.VStack,{children:[r?(0,s.jsx)(a.J,{size:"32",marginRight:"0",name:r,color:"var(--clr-brand)"}):null,i?(0,s.jsx)(l.Z,{height:"24"}):null,(0,s.jsx)(c.x,{size:4,weight:"600",mono:!1,tag:"h1",appearance:"primary",children:t}),(0,s.jsx)("div",{style:{maxWidth:"72ch"},children:(0,s.jsx)(c.x,{size:1,weight:"500",mono:!1,tag:"p",letterSpacing:"0.3px",appearance:"secondary",lineHeight:"1.5",align:"center",children:u})})]})})}},9724:function(e,r,i){"use strict";i.r(r),i.d(r,{default:function(){return I}});var s=i(6383),a=i(2322),o=i(2784),t=i(7729),n=i.n(t),c=i(9097),l=i.n(c),d=i(5632),u=i(7500),h=i(7037),f=i(9241),g=i(1893),m=function(e){var r=e.className,i=void 0===r?"":r,s=e.ref,o=e.disabled,t=e.onChange,n=e.value,c=e.children;return(0,a.jsx)("div",{className:"select ".concat(i),children:(0,a.jsx)("select",{ref:s,disabled:o,onChange:t,value:n,children:c})})},v=i(5598),p=i(2367),x=i(1251),y=i(7414),j=i(865),S=i(6670),H=i(7274);function b(e){var r=e.columns,i=e.data,s=e.initialState,o=e.classes,t=(0,H.useTable)({columns:r,data:i,initialState:s},H.useSortBy),n=t.getTableProps,c=t.getTableBodyProps,l=t.headerGroups,d=t.rows,u=t.prepareRow,h=d;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("table",(0,S.Z)((0,j.Z)({},n()),{className:"table ".concat(o),style:{width:"100%"},children:[(0,a.jsx)("thead",{children:l.map((function(e){return(0,a.jsx)("tr",(0,S.Z)((0,j.Z)({},e.getHeaderGroupProps()),{children:e.headers.map((function(e){return(0,a.jsxs)("th",(0,S.Z)((0,j.Z)({},e.getHeaderProps(e.getSortByToggleProps())),{children:[e.render("Header"),(0,a.jsx)("span",{children:e.isSorted?e.isSortedDesc?" \ud83d\udd3d":" \ud83d\udd3c":""})]}))}))}))}))}),(0,a.jsx)("tbody",(0,S.Z)((0,j.Z)({},c()),{children:h.map((function(e,r){return u(e),(0,a.jsx)("tr",(0,S.Z)((0,j.Z)({},e.getRowProps()),{children:e.cells.map((function(e){return(0,a.jsx)("td",(0,S.Z)((0,j.Z)({},e.getCellProps()),{children:e.render("Cell")}))}))}))}))}))]}))})}var D=i(8431),P=i(5416),C=i(7841),w=i(9604),k={good:"#5f9c5f",okay:"#f4c265",bad:"#ea7777",disaster:"#ae3d3d",neutral:"#6591c3"};function B(e){var r=e.value,i=e.max,s=e.color,o=void 0===s?k.neutral:s,t=e.label,n=e.showChart;return(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"0.8rem"},children:[n&&(0,a.jsx)("div",{style:{width:80},children:(0,a.jsx)("div",{style:{width:"".concat(r/i*100,"%"),height:20,background:o,borderRadius:"999px"}})}),(0,a.jsx)("div",{children:t||r})]})}var I=function(){var e=(0,g.a)(),r=(0,d.useRouter)(),i=(0,y.P)(),t=(0,o.useRef)();(0,o.useEffect)((function(){e||(location.href="/login")}),[e]);var c=(0,o.useState)({}),j=c[0],S=c[1],H=(0,o.useState)((function(){var e=u.battles.find((function(e){return(0,u.getBattleStatus)(e)===u.BattleStatuses.ONGOING}));return e||(e=u.battles.filter((function(e){return(0,u.getBattleStatus)(e)===u.BattleStatuses.FINISHED})).pop()),e})),I=H[0],N=H[1];(0,o.useEffect)((function(){if(r.isReady){var e=r.query.battleId;if(e){var i=u.battles.find((function(r){return r.id===+e}));i&&N(i)}}}),[r.isReady]);var z=(0,o.useState)(!1),T=(z[0],z[1]),_=(0,o.useState)([]),Z=_[0],R=_[1];(0,o.useEffect)((function(){e&&(T(!0),R([]),Promise.all([e.isPro?(0,h.d)(I.levelIds.filter((function(e){return e}))):Promise.resolve([]),t.current?Promise.resolve(t.current):(0,h.wd)({playerId:e.uid})]).then((function(e){var r=(0,s.Z)(e,2),i=r[0],a=r[1];T(!1),t.current=a;var o=I.levelIds.filter((function(e){return e})).map((function(e){var r,s,o,t=i.find((function(r){return e===(null===r||void 0===r?void 0:r.levelId)})),n=a[e]||{};return{targetId:e,codeDiff:n.codeSize-(null===t||void 0===t||null===(r=t.highscore)||void 0===r?void 0:r.codeSize),myHighscore:n,leaderHighscore:null===t||void 0===t?void 0:t.highscore,scoreDiff:(null===t||void 0===t||null===(s=t.highscore)||void 0===s?void 0:s.score)-n.score,leaderProfile:null===t||void 0===t||null===(o=t.highscore)||void 0===o?void 0:o.playerProfile}})),n=0,c=0,l=0,d=0;o.map((function(e){e.codeDiff>n&&(n=e.codeDiff),e.scoreDiff>c&&(c=e.scoreDiff),e.myHighscore.codeSize>l&&(l=e.myHighscore.codeSize),e.myHighscore.score>d&&(d=e.myHighscore.score)})),S({maxCharDiff:n,maxCodeSize:l,maxScore:d,maxScoreDiff:c,charDiffBreakpoints:[~~(n/3),~~(n/3*2)],scoreDiffBreakpoints:[~~(c/3),~~(c/3*2)]}),R(o)})))}),[e?e.uid:"",I.id]);var E=(0,o.useMemo)((function(){var r=[{Header:"Target",accessor:"target"},{Header:"Match",accessor:"match"},{Header:"My Score",accessor:"score",sortType:function(e,r){return e.original.myHighscore.score?r.original.myHighscore.score?e.original.myHighscore.score-r.original.myHighscore.score:1:-1}}];return(null===e||void 0===e?void 0:e.isPro)&&(r.push({Header:"Top Score",accessor:"topScore",disableSortBy:!0}),r.push({Header:"Score Diff",accessor:"scoreDiffRender",sortType:function(e,r){return e.original.myHighscore.score?r.original.myHighscore.score?e.original.scoreDiff-r.original.scoreDiff:1:-1}})),r.push({Header:"My chars",accessor:"myChars",sortType:function(e,r){return e.original.myHighscore.score?r.original.myHighscore.score?e.original.myHighscore.codeSize-r.original.myHighscore.codeSize:1:-1}}),(null===e||void 0===e?void 0:e.isPro)&&(r.push({Header:"Top chars",accessor:"topChars",disableSortBy:!0}),r.push({Header:"Char Diff",accessor:"charDiff",sortType:function(e,r){return e.original.myHighscore.score?r.original.myHighscore.score?e.original.myHighscore.match<100?-1:r.original.myHighscore.match<100?1:e.original.codeDiff-r.original.codeDiff:1:-1}}),r.push({Header:"Last played",accessor:"lastPlayed",sortType:function(e,r){return e.original.myHighscore.score?r.original.myHighscore.score?e.original.timeInSeconds-r.original.timeInSeconds:1:-1}})),r}),[null===e||void 0===e?void 0:e.isPro]),M=(0,o.useMemo)((function(){return Z.map((function(r){var i,s=r.targetId,o=r.leaderHighscore,t=r.myHighscore,n=r.codeDiff,c=r.scoreDiff,l=r.leaderProfile;return{myHighscore:t,scoreDiff:c,codeDiff:n,target:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 0"},children:[(0,a.jsx)("a",{href:"/play/".concat(s),style:{display:"flex"},children:(0,a.jsx)("img",{src:"https://cssbattle.dev/targets/".concat(s,".png"),width:"50",alt:"",style:{borderRadius:"6px"}})}),(0,a.jsxs)("span",{children:["#",s]})]}),match:100===t.match?"\u2705":t.match?"\ud83d\udd34 ".concat(t.match,"%"):"-",score:t.score?(0,a.jsx)(B,{value:t.score,max:j.maxScore,color:t.score<600?"indianred":void 0,showChart:e.isPro}):"-",topScore:(0,a.jsxs)(v.Stack,{gap:"0.5rem",align:"center",children:[(0,a.jsx)(x.qE,{small:!0,size:"25",url:null===l||void 0===l?void 0:l.avatar,username:null===l||void 0===l?void 0:l.username,userId:null===l||void 0===l?void 0:l.id}),(0,a.jsx)("span",{children:null===o||void 0===o?void 0:o.score})]}),scoreDiffRender:t.score?(0,a.jsx)(B,{value:Math.trunc(100*c)/100,max:j.maxScoreDiff,color:c<j.scoreDiffBreakpoints[0]?k.green:c>j.scoreDiffBreakpoints[1]?k.bad:k.okay,showChart:!0}):"-",myChars:t.score?(0,a.jsx)(B,{label:"{".concat(t.codeSize,"}"),value:t.codeSize,max:j.maxCodeSize,color:100===t.match?void 0:k.disaster,showChart:e.isPro}):"-",topChars:"{".concat(null===o||void 0===o?void 0:o.codeSize,"}"),charDiff:t.score&&100===t.match?(0,a.jsx)(B,{label:"{".concat(n,"}"),value:n,max:j.maxCharDiff,color:n<j.charDiffBreakpoints[0]?k.good:n>j.charDiffBreakpoints[1]?k.bad:k.okay,showChart:!0}):"-",timeInSeconds:null===(i=t.lastUpdated)||void 0===i?void 0:i.seconds,lastPlayed:t.score?"".concat((0,p.VG)(1e3*t.lastUpdated.seconds)," ago"):"-"}}))}),[Z]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n(),{children:[(0,a.jsx)("title",{children:"My Analytics | CSSBattle"},"title"),(0,a.jsx)("meta",{property:"og:title",content:"My Analytics | CSSBattle"},"ogTitle")]}),(0,a.jsx)(D.x,{icon:"stats",title:"Your stats"}),(0,a.jsx)("div",{className:"",children:e&&i?(0,a.jsx)("div",{className:"",children:(0,a.jsxs)(v.VStack,{gap:"1rem",align:"center",children:[(0,a.jsx)("div",{className:"input-container",children:(0,a.jsxs)(m,{className:"width--full",onChange:function(e){var r=parseInt(e.target.value,10);N(0!==r?u.battles.find((function(e){return e.id===r})):{levelIds:u.battles.reduce((function(e,r){return e.concat(r.levelIds)}),[])})},value:I.id,children:[(0,a.jsx)("option",{value:"0",children:"All battles"},"0"),u.battles.map((function(e){return(0,a.jsxs)("option",{value:e.id,children:["Battle #",e.id," - ",e.name]},e.id)}))]})}),Z.length?(0,a.jsx)(P.s,{children:(0,a.jsx)(b,{columns:E,data:M,classes:"my-stats-table",initialState:(null===e||void 0===e?void 0:e.isPro)?{sortBy:[{id:"scoreDiffRender",desc:!0}]}:void 0})}):(0,a.jsx)(f.R,{children:"Crunching your stats..."}),Z.length&&!e.isPro?(0,a.jsx)(P.s,{children:(0,a.jsxs)(v.VStack,{gap:"1.5rem",children:[(0,a.jsxs)(C.x,{mono:!1,weight:500,size:"1",children:["Upgrade to PLUS to get advanced analytics for your targets."," "]}),(0,a.jsxs)(v.HStack,{children:[(0,a.jsx)(l(),{href:"/plus",children:(0,a.jsx)("a",{className:"button button--primary",children:"Upgrade to Plus"})}),(0,a.jsx)("a",{href:"https://cssbattle.dev/blog/advanced-analytics",className:"button",children:(0,a.jsxs)(v.HStack,{gap:"0.25rem",children:["Learn more",(0,a.jsx)(w.J,{name:"link",size:"12",color:"var(--clr-text-light)"})]})})]})]})}):null]})}):null})]})}},3196:function(e){e.exports={innerPageHeader:"InnerPageHeader_innerPageHeader__HSMOC"}}},function(e){e.O(0,[7274,9774,2888,179],(function(){return r=4610,e(e.s=r);var r}));var r=e.O();_N_E=r}]);
//# sourceMappingURL=me-ffbf63b359eefc3f.js.map